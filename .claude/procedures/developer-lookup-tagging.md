# Developer Lookup and Tagging Procedure

## Overview
Step-by-step process for identifying the right developer for a ticket and tagging them in automated Jira comments.

## Step 1: Identify Developer from Ticket Data

### Priority Order for Developer Assignment:
1. **Current Assignee** (from Jira ticket `assignee` field)
2. **Recent Git Activity** (commits on related ECD branch)
3. **Historical Assignee** (from changelog/comments)
4. **Epic Owner** (if story belongs to epic with clear owner)
5. **Default Team Assignment** (fallback by ticket type)

### Implementation Steps:

#### A. Check Current Assignee
```python
# From Jira ticket response
if ticket.assignee:
    developer_name = ticket.assignee.displayName
    developer_account_id = ticket.assignee.accountId
```

#### B. Check Git Activity (if no assignee)
```bash
# Check recent commits on related branch
git log --grep="ECD-XXX" --pretty=format:"%an" | head -1
# Or check branch commits
git log origin/ECD-XXX-branch-name --pretty=format:"%an" | head -1
```

#### C. Lookup Account ID by Name
```python
Tool: mcp__atlassian__lookupJiraAccountId
Parameters:
  - cloudId: "67bbfd03-b309-414f-9640-908213f80628"
  - searchString: "Mohamed Belkahla"  # or other name
```

## Step 2: Developer Account ID Reference

### Known Team Members:
- **Ethan Drower:** `712020:8a829eca-ce74-4a15-a5b9-9fc5d33c7c4e`
- **Mohamed Belkahla:** `712020:27a3f2fe-9037-455d-9392-fb80ba1705c0`
- **Dang Thanh:** `[lookup required]`
- **Jason Fry:** `[lookup required]`
- **Bel Moh:** `[lookup required]`

### Lookup Process:
```python
# Get account ID for any team member
result = mcp__atlassian__lookupJiraAccountId(
    cloudId="67bbfd03-b309-414f-9640-908213f80628",
    searchString="First Last"
)
account_id = result.users.users[0].accountId
```

## Step 3: Create Developer-Targeted Comment

### Comment Format (Plain Text Targeting):
```
**@Developer Name** - [Message content with clear action items]
```

### Technical Note on Mentions:
- **Tested formats:** `[~accountid:ID]`, `{mention:ID}`, `@username` - all escaped by API
- **Current approach:** Clear name targeting in **bold** for visibility
- **Result:** Comments posted successfully with clear developer identification

### Implementation:
```python
Tool: mcp__atlassian__addCommentToJiraIssue
Parameters:
  - cloudId: "67bbfd03-b309-414f-9640-908213f80628"
  - issueIdOrKey: "ECD-XXX"
  - commentBody: "**@Mohamed Belkahla** - Your message here with clear action items"
```

## Step 4: Developer Assignment Logic

### By Ticket Pattern:
- **ECD-3XX (CiteSource):** Usually Mohamed Belkahla or Bel Moh
- **ECD-4XX (Word Add-in):** Check assignee (likely varies)
- **Bug fixes:** Check recent commits or assignee
- **Infrastructure:** Usually Ethan Drower

### By Git Activity Pattern:
- **Recent commits by Mohamed:** Tag Mohamed
- **Recent commits by Dang Thanh:** Tag Dang
- **No commits, "In Progress":** Tag current assignee with concern

## Step 5: Comment Templates by Scenario

### Gap Detection (No Git Activity):
```
üö® PM Analysis Alert: [~accountid:ACCOUNT_ID]

No git activity detected for this 'In Progress' ticket in the last 3 days.

- Is development happening on a different branch?
- Should ticket status be updated?
- Sprint deadline: [Date] - at risk for delivery

Generated by automated PM analysis on [Date]
```

### Status Mismatch:
```
‚ö†Ô∏è Status Check: [~accountid:ACCOUNT_ID]

Ticket shows 'In Progress' but recent code was merged [X] days ago.

- Should this be marked 'Complete'?
- Or is additional work planned?

Please update ticket status if work is done.
```

### Productivity Recognition:
```
‚úÖ Great Progress: [~accountid:ACCOUNT_ID]

Excellent code-ticket alignment detected:
- 5 commits over 3 days
- PR merged successfully
- Ticket completed on schedule

Keep up the great work! üéâ
```

### Code Without Ticket:
```
üîç Commit Tracking: [~accountid:ACCOUNT_ID]

Detected commits for [Feature/Fix] but no matching ticket found:
- Branch: ECD-XXX-branch-name
- Commits: X commits over Y days

Please verify ticket linkage or create missing ticket.
```

## Step 6: Escalation Rules

### When to Tag Multiple People:
- **Epic Owner + Story Developer:** For epic-level issues
- **Team Lead + Developer:** For process violations
- **All Team:** For sprint-wide concerns

### When NOT to Tag:
- **Draft tickets:** No action needed yet
- **Recently updated:** Avoid spam (< 24h since last comment)
- **Already tagged:** Don't duplicate within 48h

## Step 7: Account ID Caching Strategy

### Cache Account IDs for Performance:
```json
{
  "Mohamed Belkahla": "712020:27a3f2fe-9037-455d-9392-fb80ba1705c0",
  "Ethan Drower": "712020:8a829eca-ce74-4a15-a5b9-9fc5d33c7c4e",
  "last_updated": "2025-08-21"
}
```

### Refresh When:
- Lookup fails (user might have changed)
- New team member appears in git commits
- Monthly cache refresh

## Error Handling

### Common Issues:
- **User not found:** Fall back to untagged comment
- **Multiple matches:** Use first match, log for review
- **Permission denied:** Skip tagging, create comment without tag
- **Invalid account ID:** Refresh cache and retry

### Fallback Strategy:
```python
try:
    # Try with account ID tag
    create_comment_with_tag(account_id, message)
except:
    # Fall back to untagged comment
    create_comment(f"@{developer_name} {message}")
```

This procedure ensures reliable developer identification and tagging for all automated PM analysis comments.
