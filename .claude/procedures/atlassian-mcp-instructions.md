# Atlassian MCP Instructions and Capabilities

## Overview
Comprehensive reference for all tested Atlassian MCP tools and their usage patterns for project management automation.

## Prerequisites & Authentication
```bash
# Authentication check
/mcp  # Use this if connection fails
# Follow authentication prompts in CLI
```

**CloudId Reference:** `67bbfd03-b309-414f-9640-908213f80628`

## Core MCP Tools - Tested & Verified

### 1. Connection and User Info

#### Get User Information
```python
Tool: mcp__atlassian__atlassianUserInfo
# Returns current user account details
Response includes: account_id, email, name, account_status
```

#### Get Cloud Resources
```python
Tool: mcp__atlassian__getAccessibleAtlassianResources
# Returns available Atlassian instances and cloudIds
```

### 2. Issue Search and Retrieval

#### Search Issues with JQL
```python
Tool: mcp__atlassian__searchJiraIssuesUsingJql
Parameters:
  - cloudId: "67bbfd03-b309-414f-9640-908213f80628"
  - jql: "project = ECD AND sprint in openSprints()"
  - fields: ["summary", "status", "issuetype", "assignee", "updated", "customfield_10014"]
  - maxResults: 25  # Important: limit to avoid token overflow

# Common JQL Patterns:
- Current sprint: "project = ECD AND sprint in openSprints()"
- Epics: "project = ECD AND issuetype = Epic"
- Epic stories: "project = ECD AND issuetype = Story AND \"Epic Link\" is not EMPTY"
- Specific epic: "project = ECD AND \"Epic Link\" = ECD-84"
- Status filter: "project = ECD AND status = \"In Progress\""
```

**⚠️ Token Limit Handling:**
- Response limit: 25,000 tokens
- Use `maxResults: 25` for large queries
- Use `fields: [...]` to limit returned data
- Use pagination with `nextPageToken` if available

#### Get Individual Issue Details
```python
Tool: mcp__atlassian__getJiraIssue
Parameters:
  - cloudId: "67bbfd03-b309-414f-9640-908213f80628"
  - issueIdOrKey: "ECD-409"  # Can use key (ECD-XXX) or numeric ID
  - expand: "comments,changelog"  # Optional: get additional data

# Useful expand options:
- "comments" - Get all comments
- "changelog" - Get status change history
- "comments,changelog" - Both
```

### 3. User Management and Lookup

#### Lookup User Account IDs
```python
Tool: mcp__atlassian__lookupJiraAccountId
Parameters:
  - cloudId: "67bbfd03-b309-414f-9640-908213f80628"
  - searchString: "Mohamed Belkahla"  # Display name or email

# Returns array of matching users with account IDs
# Use for developer identification and targeting
```

**Known Team Member Account IDs:**
- **Ethan Drower:** `712020:8a829eca-ce74-4a15-a5b9-9fc5d33c7c4e`
- **Mohamed Belkahla:** `712020:27a3f2fe-9037-455d-9392-fb80ba1705c0`

### 4. Comment Creation - VERIFIED WORKING

#### Add Comments to Issues
```python
Tool: mcp__atlassian__addCommentToJiraIssue
Parameters:
  - cloudId: "67bbfd03-b309-414f-9640-908213f80628"
  - issueIdOrKey: "ECD-409"
  - commentBody: "Your comment text here"

# ✅ CONFIRMED: Comments post successfully
# ✅ CONFIRMED: Appear as authenticated user (Ethan Drower)
# ❌ LIMITATION: @mentions don't work (API escapes special characters)
# ✅ WORKAROUND: Use **@Developer Name** for clear targeting
```

**Comment Best Practices:**
- Use clear **@Developer Name** targeting
- Include action items and deadlines
- Add context like "Generated by automated PM analysis"
- Keep professional tone with emojis for categorization

### 5. Advanced Jira Features

#### Issue Transitions (Status Changes)
```python
Tool: mcp__atlassian__getTransitionsForJiraIssue
Parameters:
  - cloudId: "67bbfd03-b309-414f-9640-908213f80628"
  - issueIdOrKey: "ECD-409"
# Returns available status transitions for the issue

Tool: mcp__atlassian__transitionJiraIssue
Parameters:
  - cloudId: "67bbfd03-b309-414f-9640-908213f80628"
  - issueIdOrKey: "ECD-409"
  - transition: {"id": "transition_id"}
# Changes issue status
```

#### Issue Editing
```python
Tool: mcp__atlassian__editJiraIssue
Parameters:
  - cloudId: "67bbfd03-b309-414f-9640-908213f80628"
  - issueIdOrKey: "ECD-409"
  - fields: {"summary": "New title", "assignee": {"accountId": "account_id"}}
```

#### Create New Issues
```python
Tool: mcp__atlassian__createJiraIssue
Parameters:
  - cloudId: "67bbfd03-b309-414f-9640-908213f80628"
  - projectKey: "ECD"
  - issueTypeName: "Story"  # or "Bug", "Task", etc.
  - summary: "Issue title"
  - description: "Issue description"
  - assignee_account_id: "optional_account_id"
```

## Key Custom Fields in ECD Project

### Sprint Information
- **customfield_10020:** Sprint data array
  - Contains sprint name (e.g., "CM Sprint 3")
  - Sprint start/end dates
  - Sprint goal information

### Epic Relationships
- **customfield_10014:** Epic Link field
  - Contains Epic key (e.g., "ECD-84")
  - Used to link stories to epics

### Epic Information
- **customfield_10011:** Epic Name field
  - Human-readable epic name
  - Only present on Epic issue types

## PM Automation Patterns

### Daily Gap Detection
```python
# 1. Get sprint items
sprint_items = searchJiraIssuesUsingJql(
    jql="project = ECD AND sprint in openSprints()",
    fields=["summary", "status", "assignee", "updated"]
)

# 2. Filter "In Progress" items
in_progress = [item for item in sprint_items if item.status.name == "In Progress"]

# 3. Check git activity for each
for item in in_progress:
    # Run git analysis
    # If no activity for 2+ days, create alert comment

# 4. Post automated comments for gaps
addCommentToJiraIssue(
    issueIdOrKey=item.key,
    commentBody="**@Developer** - Gap detected, please verify status"
)
```

### Epic Progress Tracking
```python
# 1. Get all epics
epics = searchJiraIssuesUsingJql(
    jql="project = ECD AND issuetype = Epic"
)

# 2. For each epic, get linked stories
for epic in epics:
    stories = searchJiraIssuesUsingJql(
        jql=f"project = ECD AND \"Epic Link\" = {epic.key}"
    )

# 3. Calculate completion percentages
# 4. Generate progress reports
```

### Developer Productivity Analysis
```python
# 1. Get recent tickets with assignees
tickets = searchJiraIssuesUsingJql(
    jql="project = ECD AND updated >= -7d",
    fields=["assignee", "status", "updated"]
)

# 2. Correlate with git activity
# 3. Generate productivity insights per developer
# 4. Post recognition or gap alert comments
```

## Error Handling Patterns

### Common Issues and Solutions

#### Token Limit Exceeded
```python
# Problem: Response too large
# Solution: Reduce maxResults and field selection
try:
    result = searchJiraIssuesUsingJql(maxResults=50)
except TokenLimitError:
    result = searchJiraIssuesUsingJql(maxResults=25, fields=["summary", "status"])
```

#### User Lookup Failures
```python
# Problem: User not found or multiple matches
try:
    user = lookupJiraAccountId(searchString="Mohamed Belkahla")
    account_id = user.users.users[0].accountId
except (IndexError, KeyError):
    # Fallback to plain text targeting
    comment = "**@Mohamed Belkahla** (manual targeting)"
```

#### Connection Issues
```bash
# Problem: Authentication expired
# Solution: Re-authenticate via CLI
/mcp
# Select atlassian and re-authenticate
```

## Performance Best Practices

### Batch Operations
- Combine multiple searches into single session
- Cache account IDs to avoid repeated lookups
- Use field filtering to reduce response size

### Rate Limiting Awareness
- Space out comment creation (avoid rapid-fire posting)
- Use pagination for large data sets
- Monitor for API rate limit responses

### Data Caching Strategy
```python
# Cache frequently used data
developer_cache = {
    "Mohamed Belkahla": "712020:27a3f2fe-9037-455d-9392-fb80ba1705c0",
    "last_updated": "2025-08-21"
}

# Refresh cache monthly or on lookup failures
```

## Integration with Git Analysis

### Correlating Jira and Git Data
```python
# 1. Get Jira ticket data
jira_tickets = searchJiraIssuesUsingJql(...)

# 2. Get git commit data
git_commits = run_git_analysis()

# 3. Match by ECD ticket numbers
for ticket in jira_tickets:
    matching_commits = find_commits_for_ticket(ticket.key)

# 4. Identify gaps and create targeted comments
if ticket.status == "In Progress" and not matching_commits:
    create_gap_alert(ticket)
```

This comprehensive guide provides all verified MCP capabilities for robust project management automation.
